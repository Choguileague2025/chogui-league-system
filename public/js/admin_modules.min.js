const AdminTournamentModule={async init(){const o=document.getElementById("adminTournamentDisplay");if(o)try{const n=await fetch("/api/torneos");if(!n.ok)throw new Error("Error");const t=await n.json(),e=Array.isArray(t)?t:t.torneos||[];o.innerHTML='<option value="">Sin torneo activo</option>';const i=e.find(o=>o.activo);e.forEach(n=>{const t=document.createElement("option");t.value=n.id,t.textContent=n.nombre+(n.activo?" ✅":""),n.activo&&(t.selected=!0),o.appendChild(t)}),o.addEventListener("change",()=>{"undefined"!=typeof toast&&toast.info("Para cambiar el torneo activo, usa la pestaña Torneos"),i&&(o.value=i.id)}),console.log("[Admin Torneos] Display actualizado")}catch(o){console.warn("[Admin Torneos] Error:",o)}}},AdminSSEModule={connection:null,init(){if("undefined"==typeof EventSource)return;const o=document.getElementById("adminSseDot");try{this.connection=new EventSource("/api/sse/updates"),this.connection.addEventListener("stats-update",o=>{console.log("[SSE Admin] Stats update");try{const n=JSON.parse(o.data);AdminNotification.show(`Estadísticas actualizadas: ${n.tipo||"general"}`,"info")}catch{AdminNotification.show("Estadísticas actualizadas","info")}"function"==typeof cargarEstadisticas&&cargarEstadisticas(),"function"==typeof actualizarLideres&&actualizarLideres()}),this.connection.addEventListener("tournament-change",o=>{console.log("[SSE Admin] Tournament change"),AdminNotification.show("Torneo actualizado","warning"),"function"==typeof cargarTorneoActivo&&cargarTorneoActivo(),"function"==typeof cargarTorneos&&cargarTorneos(),AdminTournamentModule.init()}),this.connection.addEventListener("general-update",o=>{console.log("[SSE Admin] General update"),"function"==typeof cargarTodosLosDatos&&cargarTodosLosDatos()}),this.connection.onopen=()=>{o&&o.classList.remove("disconnected")},this.connection.onerror=()=>{o&&o.classList.add("disconnected")},console.log("[SSE Admin] Conectado")}catch(n){console.warn("[SSE Admin] Error:",n),o&&o.classList.add("disconnected")}},destroy(){this.connection&&(this.connection.close(),this.connection=null)}};window.addEventListener("beforeunload",()=>{AdminSSEModule.destroy()});const AdminNotification={show(o,n="info"){if("undefined"!=typeof toast&&toast.show)return void toast.show(o,n);const t=document.createElement("div");t.className=`notification-toast ${n}`,t.textContent=o,document.body.appendChild(t),requestAnimationFrame(()=>{t.classList.add("show")}),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>t.remove(),400)},3e3)}},FormValidation={validateStats(o){const n=[];o.jugador_id||n.push("Debe seleccionar un jugador");if(["at_bats","hits","doubles","triples","home_runs","rbi","runs","walks","strikeouts","stolen_bases","innings_pitched","earned_runs","hits_allowed","putouts","assists","errors_field"].forEach(t=>{void 0!==o[t]&&o[t]<0&&n.push(`${t.replace(/_/g," ")} no puede ser negativo`)}),void 0!==o.hits&&void 0!==o.at_bats&&o.hits>o.at_bats&&n.push("Los hits no pueden ser mayores que los turnos al bate"),void 0!==o.hits){(o.doubles||0)+(o.triples||0)+(o.home_runs||0)>o.hits&&n.push("Los extra-base hits no pueden exceder los hits totales")}return n},showErrors(o,n){const t=document.getElementById(n);t?t.innerHTML=o.map(o=>`<div class="validation-error visible">${o}</div>`).join(""):o.forEach(o=>AdminNotification.show(o,"error"))},clearErrors(o){const n=document.getElementById(o);n&&(n.innerHTML="")}};window.FormValidation=FormValidation,document.addEventListener("DOMContentLoaded",async()=>{console.log("[Admin Modules] Inicializando..."),await AdminTournamentModule.init(),AdminSSEModule.init(),console.log("[Admin Modules] Inicializados correctamente")}),console.log("✅ admin_modules.js cargado");