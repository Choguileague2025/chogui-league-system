const TournamentModule={currentTournamentId:null,allTorneos:[],async load(){try{const t=document.getElementById("indexTournamentSelect");if(!t)return;const e=await fetch("/api/torneos");if(!e.ok)throw new Error("Error cargando torneos");const n=await e.json();this.allTorneos=Array.isArray(n)?n:n.torneos||[],t.innerHTML='<option value="todos">Todos los torneos</option>',this.allTorneos.forEach(e=>{const n=document.createElement("option");n.value=e.id,n.textContent=e.nombre+(e.activo?" (Activo)":""),e.activo&&(n.selected=!0,this.currentTournamentId=String(e.id)),t.appendChild(n)}),t.addEventListener("change",t=>{this.currentTournamentId="todos"===t.target.value?"todos":t.target.value,this.onTournamentChange()}),console.log("[Torneos] Cargados:",this.allTorneos.length)}catch(t){console.error("[Torneos] Error:",t);const e=document.getElementById("indexTournamentSelect");e&&(e.innerHTML='<option value="todos">Todos los torneos</option>')}},getCurrentId(){return this.currentTournamentId},onTournamentChange(){console.log("[Torneos] Cambiado a:",this.currentTournamentId),"function"==typeof cargarLideres&&cargarLideres(),"function"==typeof cargarEstadisticasCompletas&&cargarEstadisticasCompletas(),"function"==typeof cargarLideresOfensivos&&cargarLideresOfensivos(),"function"==typeof cargarTablaPosiciones&&cargarTablaPosiciones(),NotificationModule.show("Torneo actualizado","info")}},PaginationModule={currentPage:1,itemsPerPage:15,totalData:[],tbodyId:null,renderFn:null,init(t,e){this.tbodyId=t,this.renderFn=e,this.currentPage=1;const n=document.getElementById("prevPageStats"),o=document.getElementById("nextPageStats");n&&n.addEventListener("click",()=>this.previousPage()),o&&o.addEventListener("click",()=>this.nextPage())},setData(t){this.totalData=Array.isArray(t)?t:[],this.currentPage=1,this.render()},render(){const t=(this.currentPage-1)*this.itemsPerPage,e=t+this.itemsPerPage,n=this.totalData.slice(t,e);this.renderFn&&this.renderFn(n,t),this.updateControls()},updateControls(){const t=Math.max(1,Math.ceil(this.totalData.length/this.itemsPerPage)),e=document.getElementById("currentPageStats"),n=document.getElementById("totalPagesStats"),o=document.getElementById("prevPageStats"),a=document.getElementById("nextPageStats"),s=document.getElementById("statsPagination");e&&(e.textContent=this.currentPage),n&&(n.textContent=t),o&&(o.disabled=this.currentPage<=1),a&&(a.disabled=this.currentPage>=t),s&&(s.style.display=t<=1?"none":"flex")},nextPage(){const t=Math.ceil(this.totalData.length/this.itemsPerPage);this.currentPage<t&&(this.currentPage++,this.render())},previousPage(){this.currentPage>1&&(this.currentPage--,this.render())},filter(t){this.currentPage=1,this.render()}},NotificationModule={show(t,e="info"){const n=document.createElement("div");n.className=`notification-toast ${e}`,n.textContent=t,document.body.appendChild(n),requestAnimationFrame(()=>{n.classList.add("show")}),setTimeout(()=>{n.classList.remove("show"),setTimeout(()=>n.remove(),400)},3e3)}},SSEModule={connection:null,statusDot:null,init(){if("undefined"!=typeof EventSource){this.statusDot=document.getElementById("sseDot");try{this.connection=new EventSource("/api/sse/updates"),this.connection.addEventListener("stats-update",t=>{console.log("[SSE] Stats update recibido"),NotificationModule.show("Estad√≠sticas actualizadas","info"),"function"==typeof cargarLideres&&cargarLideres(),"function"==typeof cargarEstadisticasCompletas&&cargarEstadisticasCompletas(),"function"==typeof cargarLideresOfensivos&&cargarLideresOfensivos()}),this.connection.addEventListener("tournament-change",t=>{console.log("[SSE] Tournament change recibido"),NotificationModule.show("Torneo actualizado","warning"),TournamentModule.load(),"function"==typeof cargarTablaPosiciones&&cargarTablaPosiciones(),"function"==typeof cargarLideres&&cargarLideres()}),this.connection.addEventListener("general-update",t=>{console.log("[SSE] General update recibido"),"function"==typeof cargarTablaPosiciones&&cargarTablaPosiciones(),"function"==typeof cargarUltimosPartidos&&cargarUltimosPartidos()}),this.connection.onopen=()=>{console.log("[SSE] Conectado"),this.statusDot&&this.statusDot.classList.remove("disconnected")},this.connection.onerror=()=>{console.warn("[SSE] Error de conexi√≥n"),this.statusDot&&this.statusDot.classList.add("disconnected")}}catch(t){console.warn("[SSE] No se pudo conectar:",t)}}else console.warn("[SSE] EventSource no soportado")},destroy(){this.connection&&(this.connection.close(),this.connection=null)}};window.addEventListener("beforeunload",()=>{SSEModule.destroy()});const StatsSearchModule={init(){const t=document.getElementById("searchStatsTable");if(!t)return;let e;t.addEventListener("input",t=>{clearTimeout(e),e=setTimeout(()=>{const e=t.target.value.trim().toLowerCase();if(e){if("undefined"!=typeof estadisticas){const t=estadisticas.filter(t=>(t.jugador_nombre||"").toLowerCase().includes(e)||(t.equipo_nombre||"").toLowerCase().includes(e));PaginationModule.totalData=t,PaginationModule.currentPage=1,PaginationModule.render()}}else PaginationModule.setData(PaginationModule.totalData)},300)})}};document.addEventListener("DOMContentLoaded",async()=>{console.log("[Modules] Inicializando m√≥dulos de optimizaci√≥n..."),await TournamentModule.load(),SSEModule.init(),StatsSearchModule.init(),PaginationModule.init("statsTable",(t,e)=>{const n=document.querySelector("#statsTable tbody");n&&(0!==t.length?n.innerHTML=t.map((t,e)=>{const n=parseInt(t.at_bats)||0,o=parseInt(t.hits)||0,a=parseInt(t.doubles)||0,s=parseInt(t.triples)||0,i=parseInt(t.home_runs)||0,r=parseInt(t.rbi)||0,d=parseInt(t.runs)||0,c=parseInt(t.walks)||0,l=parseInt(t.strikeouts)||0,u=parseInt(t.stolen_bases)||0,g=parseInt(t.caught_stealing)||0,p=parseInt(t.hit_by_pitch)||0,m=parseInt(t.sacrifice_flies)||0,h=o-a-s-i,f=n+c+p+m,y=n>0?o/n:0,E=n+c+p+m>0?(o+c+p)/(n+c+p+m):0,P=n>0?(h+2*a+3*s+4*i)/n:0,v=E+P,T=P-y,b=h+2*a+3*s+4*i;return`<tr onclick="window.location.href='jugador.html?id=${t.jugador_id}'">\n                <td>${t.jugador_nombre||"-"}</td>\n                <td>${t.equipo_nombre||"-"}</td>\n                <td>${t.posicion||"-"}</td>\n                <td>${f}</td>\n                <td>${n}</td>\n                <td>${o}</td>\n                <td>${h}</td>\n                <td>${a}</td>\n                <td>${s}</td>\n                <td>${i}</td>\n                <td>${r}</td>\n                <td>${d}</td>\n                <td>${c}</td>\n                <td>${l}</td>\n                <td>${u}</td>\n                <td>${g}</td>\n                <td>${y.toFixed(3)}</td>\n                <td>${E.toFixed(3)}</td>\n                <td>${P.toFixed(3)}</td>\n                <td>${v.toFixed(3)}</td>\n                <td>${T.toFixed(3)}</td>\n                <td>${b}</td>\n            </tr>`}).join(""):n.innerHTML='<tr><td colspan="22" class="loading">No hay datos disponibles</td></tr>')}),console.log("[Modules] M√≥dulos inicializados correctamente")}),window.addEventListener("load",()=>{"function"==typeof window.cargarEstadisticasCompletas&&(window.cargarEstadisticasCompletas=async function(){try{const t="function"==typeof getApiUrl?getApiUrl("/api/estadisticas-ofensivas"):"/api/estadisticas-ofensivas",e=await fetch(t,{headers:{Accept:"application/json"}});if(!e.ok)throw new Error(`HTTP ${e.status}`);const n=await e.json();let o;o=(n||[]).some(t=>"2025"===(t.temporada??"").toString().trim())?n.filter(t=>"2025"===(t.temporada??"").toString().trim()):n||[],"undefined"!=typeof estadisticas&&(window.estadisticas=o),PaginationModule.setData(o);try{const t="undefined"!=typeof leadersData&&leadersData.defensiva||[],e=document.getElementById("positionLeadersGrid");if(e&&t.length>0){const n={};t.forEach(t=>{const e=t.posicion||"UTIL",o=parseFloat(t.fielding_percentage)||0;(!n[e]||o>parseFloat(n[e].fielding_percentage||0))&&(n[e]=t)});const o=Object.values(n).sort((t,e)=>(parseFloat(e.fielding_percentage)||0)-(parseFloat(t.fielding_percentage)||0)).slice(0,4);e.innerHTML=o.map(t=>{const e=parseFloat(t.fielding_percentage)||0,n=parseInt(t.putouts)||0,o=parseInt(t.assists)||0,a=parseInt(t.errors)||0;return`\n                                <div class="position-card" style="background:#161b22;border-radius:16px;padding:20px;border:2px solid rgba(255,193,7,0.2);">\n                                    <div style="color:#ffc107;font-size:1.2rem;font-weight:bold;margin-bottom:15px;">üõ°Ô∏è ${t.posicion||"UTIL"}</div>\n                                    <div style="display:flex;flex-direction:column;gap:8px;">\n                                        <div style="font-weight:bold;color:#fff;">${t.jugador_nombre||"N/A"}</div>\n                                        <div style="color:rgba(255,255,255,0.7);font-size:0.85rem;">${t.equipo_nombre||""}</div>\n                                        <div style="color:#ffc107;font-size:1.1rem;font-weight:bold;">FLD% ${e.toFixed(3)}</div>\n                                        <div style="color:rgba(255,255,255,0.6);font-size:0.8rem;">PO:${n} A:${o} E:${a}</div>\n                                    </div>\n                                </div>`}).join("")}}catch(t){console.warn("Position leaders render:",t)}}catch(t){console.error("Error cargando estad√≠sticas completas:",t)}},console.log("[Modules] cargarEstadisticasCompletas wrapped with pagination"))}),console.log("‚úÖ index_modules.js cargado");